<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scrapscript Web REPL</title>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAD/AAAA////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAREBEQAAAAAQAQEAEAAAABABAQAQAAAAAREBEQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACIiIiIiIiIiIiIiIiIiIiIiERIiESEiIiIiESEiISIiIhEiISIhEiIiIREiESEhIiIiIiIiIiIiIiIiIiIiIiIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,500;0,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,400;0,700;0,900;1,400&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main>
      <div>
      <p>See <a href="https://scrapscript.org/">scrapscript.org</a> for a slightly
      out of date language reference.</p>
      <p>This REPL is run completely in the browser using PyScript/Pyodide.</p>
      </div>
      <script>
      "use strict";

      async function main() {
        // const scrapscript = await fetch('/scrapscript.py');
        let indexURL = "https://cdn.jsdelivr.net/pyodide/v0.25.1/full/";
        const urlParams = new URLSearchParams(window.location.search);
        const buildParam = urlParams.get("build");
        if (buildParam) {
          if (["full", "debug", "pyc"].includes(buildParam)) {
            indexURL = indexURL.replace(
              "/full/",
              "/" + urlParams.get("build") + "/",
            );
          } else {
            console.warn(
              'Invalid URL parameter: build="' +
                buildParam +
                '". Using default "full".',
            );
          }
        }
        const { loadPyodide } = await import(indexURL + "pyodide.mjs");
        const pyodide = await loadPyodide({
          stdout: (msg) => console.log(`Pyodide: ${msg}`),
        });
        await pyodide.runPythonAsync(`
            from pyodide.http import pyfetch
            response = await pyfetch("/scrapscript.py")
            with open("scrapscript.py", "wb") as f:
                f.write(await response.bytes())
        `)
        const pkg = pyodide.pyimport("scrapscript");
        console.log(pkg.eval_end_to_end("1+2"));
      }
      main();
      </script>
    </main>
    <script data-goatcounter="https://scrapscript.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
  </body>
</html>
